# 推送 package-lock.json 到 GitHub 脚本

Write-Host "准备推送 package-lock.json 到 GitHub..." -ForegroundColor Cyan
Write-Host ""

# 进入项目目录
$projectPath = "C:\Users\26872\Desktop\心理网站编写\02 管理器"
Set-Location $projectPath

Write-Host "当前目录: $PWD" -ForegroundColor Yellow
Write-Host ""

# 1. 检查 Git 状态
Write-Host "检查 Git 状态..." -ForegroundColor Yellow
git status --short package-lock.json

# 2. 检查分支
Write-Host ""
Write-Host "当前分支:" -ForegroundColor Yellow
git branch

# 3. 添加文件
Write-Host ""
Write-Host "添加 package-lock.json..." -ForegroundColor Yellow
git add package-lock.json
if ($LASTEXITCODE -eq 0) {
    Write-Host "文件已添加到暂存区" -ForegroundColor Green
} else {
    Write-Host "添加文件失败" -ForegroundColor Red
    exit 1
}

# 4. 检查是否有更改需要提交
$status = git status --porcelain package-lock.json
if ($status) {
    Write-Host ""
    Write-Host "提交更改..." -ForegroundColor Yellow
    git commit -m "fix: 更新 package-lock.json 包含完整的 crypto-js 包信息"
    if ($LASTEXITCODE -eq 0) {
        Write-Host "提交成功" -ForegroundColor Green
    } else {
        Write-Host "提交失败" -ForegroundColor Red
        exit 1
    }
} else {
    Write-Host ""
    Write-Host "没有需要提交的更改" -ForegroundColor Yellow
}

# 5. 推送
Write-Host ""
Write-Host "推送到 GitHub..." -ForegroundColor Yellow
$branch = git branch --show-current
Write-Host "分支: $branch" -ForegroundColor Gray

$pushOutput = git push origin $branch 2>&1

if ($LASTEXITCODE -eq 0) {
    Write-Host ""
    Write-Host "推送成功！" -ForegroundColor Green
    Write-Host "仓库: https://github.com/mindcube111/mindcube" -ForegroundColor Cyan
    Write-Host "分支: $branch" -ForegroundColor Cyan
} else {
    Write-Host ""
    Write-Host "推送失败，错误信息：" -ForegroundColor Red
    Write-Host $pushOutput -ForegroundColor Yellow
    
    Write-Host ""
    Write-Host "可能的解决方案：" -ForegroundColor Yellow
    Write-Host "1. 检查网络连接" -ForegroundColor White
    Write-Host "2. 确认 GitHub 认证（使用 Personal Access Token）" -ForegroundColor White
    Write-Host "3. 检查分支名称是否正确（main 或 master）" -ForegroundColor White
    Write-Host "4. 如果提示 'Everything up-to-date'，说明已经推送过了" -ForegroundColor White
}

Write-Host ""
