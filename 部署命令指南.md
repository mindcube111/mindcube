# 🚀 部署命令指南

## 📋 标准部署流程

### 第一步：构建项目

```powershell
npm run build
```

这会：
- 编译 TypeScript
- 构建前端代码
- 复制 `functions/` 目录到 `dist/functions/`

### 第二步：提交代码到 Git

```powershell
# 查看更改的文件
git status

# 添加所有更改的文件
git add .

# 提交更改（请修改为合适的提交信息）
git commit -m "添加登录注册验证码功能"

# 推送到远程仓库（触发自动部署）
git push
```

### 第三步：等待 Cloudflare 自动部署

推送后，Cloudflare Pages 会自动检测到更改并开始部署：

1. **登录 Cloudflare Dashboard**
   - 访问：https://dash.cloudflare.com/
   - 进入：**Workers 和 Pages** → **psychological-assessment-platform**

2. **查看部署状态**
   - 点击 **部署**（Deployments）标签
   - 应该能看到新的部署正在进行中
   - 等待部署完成（显示绿色成功图标，通常需要 3-5 分钟）

---

## ⚡ 快速部署命令（一键执行）

```powershell
# 完整部署流程（复制粘贴执行）
npm run build && git add . && git commit -m "更新: 添加验证码功能" && git push
```

---

## 🔍 部署验证

### 检查部署状态

在 Cloudflare Dashboard → Deployments 页面：
- ✅ 查看最新部署状态（成功/失败/进行中）
- ✅ 查看构建日志（如果有错误会显示）
- ✅ 确认部署时间是最新的

### 测试网站

部署完成后，访问：
```
https://mindcube.top
```

测试功能：
- ✅ 登录页面（应该显示验证码）
- ✅ 注册页面（应该显示验证码）
- ✅ 其他功能是否正常

---

## 🔧 如果部署失败

### 方法 1：重新触发部署

```powershell
# 创建一个空提交来触发重新部署
git commit --allow-empty -m "重新触发部署"
git push
```

### 方法 2：在 Cloudflare Dashboard 手动重新部署

1. 进入 Cloudflare Dashboard → Deployments
2. 找到最新的部署
3. 点击 **重新部署**（Retry deployment）

### 方法 3：检查构建配置

在 Cloudflare Dashboard → Settings → Build：

- **构建命令**：`npm run build`
- **构建输出目录**：`dist`（不能是 `/dist` 或其他）
- **根目录**：`/`

---

## 📝 常用命令总结

```powershell
# 1. 构建项目
npm run build

# 2. 查看 Git 状态
git status

# 3. 添加所有文件
git add .

# 4. 提交更改
git commit -m "你的提交信息"

# 5. 推送到远程（触发部署）
git push

# 6. 查看最近的提交
git log --oneline -5

# 7. 如果有冲突，先拉取最新代码
git pull

# 8. 强制推送（谨慎使用，仅用于紧急情况）
git push --force
```

---

## 🎯 当前项目部署信息

- **项目名称**：psychological-assessment-platform
- **部署平台**：Cloudflare Pages
- **部署方式**：Git 推送自动部署
- **GitHub 仓库**：https://github.com/yo385042-blip/-psychological-assessment-platform
- **网站地址**：https://mindcube.top
- **构建命令**：`npm run build`
- **输出目录**：`dist`

---

## ⚠️ 注意事项

1. **环境变量**：如果在 Cloudflare Dashboard 中修改了环境变量，需要重新部署才能生效
2. **构建时间**：通常需要 3-5 分钟，请耐心等待
3. **缓存**：部署后如果看不到更新，尝试清除浏览器缓存或使用无痕模式
4. **Functions**：确保 `functions/` 目录已推送到 GitHub

---

## 🆘 问题排查

如果部署遇到问题：

1. **检查构建日志**
   - Cloudflare Dashboard → Deployments → 点击最新部署 → 查看构建日志

2. **检查 Git 状态**
   ```powershell
   git status
   git log --oneline -5
   ```

3. **检查本地构建**
   ```powershell
   npm run build
   # 查看 dist 目录是否存在且包含文件
   ```

4. **查看错误信息**
   - 截图或复制错误信息
   - 告诉我具体的问题

---

**最后更新**：2025年12月

