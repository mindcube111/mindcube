# ğŸš€ ä»£ç ä¼˜åŒ–å»ºè®®

åŸºäºä»£ç æ£€æŸ¥ç»“æœï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä¼˜åŒ–å»ºè®®ï¼ŒæŒ‰ä¼˜å…ˆçº§å’Œå½±å“ç¨‹åº¦åˆ†ç±»ã€‚

## ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³ä¿®å¤ï¼‰

### 1. ç»Ÿä¸€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ

**é—®é¢˜**ï¼šå‘ç° 74 å¤„ `console.log/error/warn` è°ƒç”¨ï¼Œç”Ÿäº§ç¯å¢ƒå¯èƒ½æ³„éœ²è°ƒè¯•ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºç»Ÿä¸€çš„æ—¥å¿—å·¥å…·

```typescript
// src/utils/logger.ts
const isDev = import.meta.env.DEV

export const logger = {
  log: (...args: any[]) => {
    if (isDev) console.log('[LOG]', ...args)
    // ç”Ÿäº§ç¯å¢ƒå¯ä»¥å‘é€åˆ°æ—¥å¿—æœåŠ¡
  },
  error: (...args: any[]) => {
    console.error('[ERROR]', ...args)
    // ç”Ÿäº§ç¯å¢ƒå‘é€åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
  },
  warn: (...args: any[]) => {
    if (isDev) console.warn('[WARN]', ...args)
  },
  info: (...args: any[]) => {
    if (isDev) console.info('[INFO]', ...args)
  },
}
```

**å½±å“**ï¼šæé«˜å®‰å…¨æ€§ï¼Œç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼Œä¾¿äºç”Ÿäº§ç¯å¢ƒç›‘æ§

---

### 2. å®Œå–„ API ç±»å‹å®šä¹‰

**é—®é¢˜**ï¼šAPI å“åº”ä½¿ç”¨ `any` ç±»å‹ï¼Œå¯èƒ½éšè—ç±»å‹é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼šä¸ºæ‰€æœ‰ API æ¥å£å®šä¹‰æ˜ç¡®çš„ç±»å‹

```typescript
// src/services/api/types.ts
export interface Order {
  id: string
  outTradeNo: string
  amount: number
  status: 'pending' | 'paid' | 'failed'
  userId?: string
  linkId?: string
  questionnaireType?: string
  createdAt: string
  paidAt?: string
}

export interface OrderResponse {
  success: boolean
  data?: Order
  message?: string
}

// åœ¨ PaymentResult.tsx ä¸­ä½¿ç”¨
const orderResp = await apiClient.get<OrderResponse>(`/orders/${outTradeNo}`)
```

**å½±å“**ï¼šæé«˜ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯

---

### 3. ä¿®å¤ PaymentResult ä¸­çš„ API è°ƒç”¨

**é—®é¢˜**ï¼šç›´æ¥ä½¿ç”¨ `fetch`ï¼Œæœªä½¿ç”¨ç»Ÿä¸€çš„ `apiClient`ï¼Œä¸”æ¥å£è·¯å¾„å¯èƒ½ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
// src/pages/PaymentResult.tsx
import { apiClient } from '@/services/api/client'
import type { Order } from '@/services/api/types'

const checkOrderStatus = async (outTradeNo: string, tradeStatus: string | null) => {
  try {
    // ä½¿ç”¨ç»Ÿä¸€çš„ API å®¢æˆ·ç«¯
    const response = await apiClient.get<Order>(`/orders/${outTradeNo}`)
    
    if (response.success && response.data) {
      const order = response.data
      // ... å¤„ç†é€»è¾‘
    }
  } catch (error) {
    // ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
    const message = handleError(error)
    setResult({ success: false, message })
  }
}
```

**å½±å“**ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†ï¼Œæé«˜ä»£ç ä¸€è‡´æ€§

---

### 4. æ·»åŠ é”™è¯¯è¾¹ç•Œç»„ä»¶

**é—®é¢˜**ï¼šå•ä¸ªç»„ä»¶é”™è¯¯å¯èƒ½å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒ

**è§£å†³æ–¹æ¡ˆ**ï¼šä¸ºå…³é”®é¡µé¢æ·»åŠ é”™è¯¯è¾¹ç•Œ

```typescript
// src/components/ErrorBoundary.tsxï¼ˆå·²å­˜åœ¨ï¼Œéœ€è¦å¢å¼ºï¼‰
// åœ¨å…³é”®é¡µé¢ä½¿ç”¨ï¼š
<ErrorBoundary fallback={<ErrorFallback />}>
  <Payment />
</ErrorBoundary>
```

**å½±å“**ï¼šæé«˜åº”ç”¨ç¨³å®šæ€§ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ

---

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸä¼˜åŒ–ï¼‰

### 5. ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶

**é—®é¢˜**ï¼šé”™è¯¯å¤„ç†åˆ†æ•£åœ¨å„å¤„ï¼Œä¸å¤Ÿç»Ÿä¸€

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ç°æœ‰çš„ `errorHandler.ts`ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰é”™è¯¯

```typescript
// åœ¨ API è°ƒç”¨ä¸­ç»Ÿä¸€ä½¿ç”¨
try {
  const result = await apiClient.get('/some-endpoint')
  if (!result.success) {
    throw new AppError(result.message || 'è¯·æ±‚å¤±è´¥', ErrorType.NETWORK)
  }
} catch (error) {
  const message = handleError(error)
  toast.error(message)
}
```

**å½±å“**ï¼šç»Ÿä¸€é”™è¯¯æç¤ºï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ

---

### 6. ä¼˜åŒ– useApiCache Hook

**é—®é¢˜**ï¼š`fetcher` å‡½æ•°æ¯æ¬¡éƒ½æ˜¯æ–°çš„å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„é‡æ–°è¯·æ±‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `useRef` å­˜å‚¨ fetcher

```typescript
// src/hooks/useApiCache.ts
const fetcherRef = useRef(fetcher)
useEffect(() => {
  fetcherRef.current = fetcher
}, [fetcher])

const fetchData = useCallback(async (force = false) => {
  // ä½¿ç”¨ fetcherRef.current è€Œä¸æ˜¯ fetcher
  const result = await fetcherRef.current()
  // ...
}, [key, enabled, cacheTime])
```

**å½±å“**ï¼šå‡å°‘ä¸å¿…è¦çš„ API è¯·æ±‚ï¼Œæé«˜æ€§èƒ½

---

### 7. æ·»åŠ è¯·æ±‚å»é‡å’Œé˜²æŠ–

**é—®é¢˜**ï¼šå¿«é€Ÿç‚¹å‡»å¯èƒ½å¯¼è‡´é‡å¤è¯·æ±‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨å…³é”®æ“ä½œä¸­æ·»åŠ é˜²æŠ–

```typescript
// src/utils/debounce.ts
export function debounce<T extends (...args: any[]) => any>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void {
  let timeout: NodeJS.Timeout | null = null
  return (...args: Parameters<T>) => {
    if (timeout) clearTimeout(timeout)
    timeout = setTimeout(() => func(...args), wait)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const debouncedSubmit = useMemo(
  () => debounce(handleSubmit, 300),
  [handleSubmit]
)
```

**å½±å“**ï¼šé˜²æ­¢é‡å¤æäº¤ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ

---

### 8. å®Œå–„è¡¨å•éªŒè¯

**é—®é¢˜**ï¼šéƒ¨åˆ†è¡¨å•éªŒè¯ä¸å¤Ÿå®Œå–„

**è§£å†³æ–¹æ¡ˆ**ï¼šç»Ÿä¸€ä½¿ç”¨ `validation.ts` ä¸­çš„éªŒè¯å‡½æ•°

```typescript
// åœ¨è¡¨å•æäº¤å‰ç»Ÿä¸€éªŒè¯
const validation = validateTextLength(description, 0, 500, 'æè¿°')
if (!validation.isValid) {
  toast.error(validation.message)
  return
}
```

**å½±å“**ï¼šæé«˜æ•°æ®è´¨é‡ï¼Œå‡å°‘åç«¯éªŒè¯å‹åŠ›

---

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

### 9. æ·»åŠ å•å…ƒæµ‹è¯•

**å»ºè®®**ï¼šä¸ºå…³é”®åŠŸèƒ½æ·»åŠ æµ‹è¯•

```typescript
// src/utils/validation.test.ts
import { describe, it, expect } from 'vitest'
import { validateTextLength } from './validation'

describe('validateTextLength', () => {
  it('should validate text length correctly', () => {
    expect(validateTextLength('test', 0, 10).isValid).toBe(true)
    expect(validateTextLength('test', 5, 10).isValid).toBe(false)
  })
})
```

**å½±å“**ï¼šæé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘å›å½’é”™è¯¯

---

### 10. æ€§èƒ½ç›‘æ§

**å»ºè®®**ï¼šæ·»åŠ æ€§èƒ½ç›‘æ§å·¥å…·

```typescript
// src/utils/performance.ts
export function measurePerformance(name: string, fn: () => void) {
  if (import.meta.env.DEV) {
    const start = performance.now()
    fn()
    const end = performance.now()
    console.log(`[Performance] ${name}: ${end - start}ms`)
  } else {
    fn()
  }
}
```

**å½±å“**ï¼šè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

### 11. ä»£ç æ–‡æ¡£

**å»ºè®®**ï¼šæ·»åŠ  JSDoc æ³¨é‡Š

```typescript
/**
 * è¿½è¸ªè½¬åŒ–æ¼æ–—æ­¥éª¤
 * @param step - æ¼æ–—æ­¥éª¤
 * @param questionnaireType - é—®å·ç±»å‹ï¼ˆå¯é€‰ï¼‰
 * @param amount - é‡‘é¢ï¼ˆå¯é€‰ï¼‰
 * @param metadata - é¢å¤–å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰
 */
trackFunnelStep(
  step: FunnelStep,
  questionnaireType?: string,
  amount?: number,
  metadata?: Record<string, any>
)
```

**å½±å“**ï¼šæé«˜ä»£ç å¯ç»´æŠ¤æ€§

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å›¾ç‰‡ä¼˜åŒ–

**å½“å‰çŠ¶æ€**ï¼šâœ… å·²æ·»åŠ  `loading="lazy"` å’Œå°ºå¯¸å±æ€§

**è¿›ä¸€æ­¥ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ WebP æ ¼å¼å›¾ç‰‡
- æ·»åŠ å›¾ç‰‡ CDN
- ä½¿ç”¨å“åº”å¼å›¾ç‰‡ï¼ˆ`srcset`ï¼‰

### 2. ä»£ç åˆ†å‰²

**å½“å‰çŠ¶æ€**ï¼šâœ… å·²ä½¿ç”¨ Lazy Loading

**è¿›ä¸€æ­¥ä¼˜åŒ–**ï¼š
- æŒ‰è·¯ç”±è¿›ä¸€æ­¥åˆ†å‰²
- å…±äº«ç»„ä»¶å•ç‹¬æ‰“åŒ…
- ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…

### 3. ç¼“å­˜ç­–ç•¥

**å½“å‰çŠ¶æ€**ï¼šâœ… å·²å®ç° API ç¼“å­˜

**è¿›ä¸€æ­¥ä¼˜åŒ–**ï¼š
- Service Worker ç¼“å­˜é™æ€èµ„æº
- ä½¿ç”¨ IndexedDB å­˜å‚¨å¤§é‡æ•°æ®
- å®ç°ç¦»çº¿åŠŸèƒ½

---

## ğŸ”’ å®‰å…¨æ€§ä¼˜åŒ–å»ºè®®

### 1. Token å®‰å…¨

**å»ºè®®**ï¼š
- Token å­˜å‚¨åœ¨ `httpOnly` cookie ä¸­ï¼ˆå¦‚æœå¯èƒ½ï¼‰
- å®ç° Token åˆ·æ–°æœºåˆ¶
- æ·»åŠ  Token è¿‡æœŸæç¤º

### 2. è¾“å…¥éªŒè¯

**å½“å‰çŠ¶æ€**ï¼šâœ… å·²å®ç° XSS é˜²æŠ¤å’Œè¾“å…¥éªŒè¯

**è¿›ä¸€æ­¥ä¼˜åŒ–**ï¼š
- åç«¯ä¹Ÿè¿›è¡Œç›¸åŒçš„éªŒè¯ï¼ˆåŒé‡éªŒè¯ï¼‰
- æ·»åŠ  CSRF ä¿æŠ¤
- å®ç°é€Ÿç‡é™åˆ¶

### 3. æ•æ„Ÿæ•°æ®

**å»ºè®®**ï¼š
- ä¸åœ¨å‰ç«¯å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨åŠ å¯†å­˜å‚¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
- å®šæœŸæ¸…ç† localStorage

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®

### 1. åŠ è½½çŠ¶æ€

**å½“å‰çŠ¶æ€**ï¼šâœ… å·²æœ‰åŸºæœ¬åŠ è½½çŠ¶æ€

**ä¼˜åŒ–**ï¼š
- æ·»åŠ éª¨æ¶å±ï¼ˆSkeletonï¼‰
- ä¼˜åŒ–åŠ è½½åŠ¨ç”»
- é¢„åŠ è½½å…³é”®èµ„æº

### 2. é”™è¯¯æç¤º

**ä¼˜åŒ–**ï¼š
- ä½¿ç”¨æ›´å‹å¥½çš„é”™è¯¯æç¤º
- æä¾›é”™è¯¯æ¢å¤å»ºè®®
- æ·»åŠ é‡è¯•æœºåˆ¶

### 3. å“åº”å¼è®¾è®¡

**æ£€æŸ¥**ï¼š
- ç¡®ä¿æ‰€æœ‰é¡µé¢åœ¨ç§»åŠ¨ç«¯æ­£å¸¸æ˜¾ç¤º
- æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸
- ä¼˜åŒ–è§¦æ‘¸äº¤äº’

---

## ğŸ“ˆ æ•°æ®ç®¡ç†ä¼˜åŒ–å»ºè®®

### 1. çŠ¶æ€ç®¡ç†

**å»ºè®®**ï¼š
- è€ƒè™‘ä½¿ç”¨ Zustand æˆ– Reduxï¼ˆå¦‚æœçŠ¶æ€å¤æ‚ï¼‰
- ç»Ÿä¸€ç®¡ç†å…¨å±€çŠ¶æ€
- å‡å°‘ prop drilling

### 2. æ•°æ®åŒæ­¥

**å»ºè®®**ï¼š
- å®ç°ä¹è§‚æ›´æ–°
- æ·»åŠ æ•°æ®åŒæ­¥æœºåˆ¶
- å¤„ç†å¹¶å‘æ›´æ–°å†²çª

---

## ğŸ› ï¸ å¼€å‘ä½“éªŒä¼˜åŒ–å»ºè®®

### 1. ç±»å‹å®šä¹‰

**å»ºè®®**ï¼š
- ç”Ÿæˆ API ç±»å‹å®šä¹‰ï¼ˆä½¿ç”¨å·¥å…·å¦‚ openapi-typescriptï¼‰
- ç»Ÿä¸€ç±»å‹å‘½åè§„èŒƒ
- å‡å°‘ç±»å‹é‡å¤å®šä¹‰

### 2. ä»£ç è§„èŒƒ

**å»ºè®®**ï¼š
- ä½¿ç”¨ Prettier ç»Ÿä¸€ä»£ç æ ¼å¼
- æ·»åŠ  pre-commit hooks
- ä½¿ç”¨ Husky è‡ªåŠ¨æ£€æŸ¥

### 3. å¼€å‘å·¥å…·

**å»ºè®®**ï¼š
- æ·»åŠ  React DevTools
- ä½¿ç”¨ Redux DevToolsï¼ˆå¦‚æœä½¿ç”¨ Reduxï¼‰
- æ·»åŠ æ€§èƒ½åˆ†æå·¥å…·

---

## ğŸ“ å®æ–½ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰
1. âœ… ç»Ÿä¸€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ
2. âœ… å®Œå–„ API ç±»å‹å®šä¹‰
3. âœ… ä¿®å¤ PaymentResult API è°ƒç”¨
4. âœ… æ·»åŠ é”™è¯¯è¾¹ç•Œ

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-4å‘¨ï¼‰
5. âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
6. âœ… ä¼˜åŒ– useApiCache Hook
7. âœ… æ·»åŠ è¯·æ±‚é˜²æŠ–
8. âœ… å®Œå–„è¡¨å•éªŒè¯

### ç¬¬ä¸‰é˜¶æ®µï¼ˆé•¿æœŸï¼‰
9. âœ… æ·»åŠ å•å…ƒæµ‹è¯•
10. âœ… æ€§èƒ½ç›‘æ§
11. âœ… ä»£ç æ–‡æ¡£
12. âœ… å…¶ä»–ä¼˜åŒ–é¡¹

---

## ğŸ¯ æ€»ç»“

**å½“å‰ä»£ç è´¨é‡ï¼šè‰¯å¥½** âœ…

**ä¸»è¦ä¼˜åŠ¿**ï¼š
- ä»£ç ç»“æ„æ¸…æ™°
- å®‰å…¨æ€§æªæ–½å®Œå–„
- æ€§èƒ½ä¼˜åŒ–åˆ°ä½
- ç”¨æˆ·ä½“éªŒè‰¯å¥½

**ä¸»è¦æ”¹è¿›ç‚¹**ï¼š
- ç»Ÿä¸€æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- å®Œå–„ç±»å‹å®šä¹‰
- æ·»åŠ æµ‹è¯•è¦†ç›–
- ä¼˜åŒ–å¼€å‘ä½“éªŒ

**å»ºè®®**ï¼šæŒ‰ç…§ä¼˜å…ˆçº§é€æ­¥å®æ–½ä¼˜åŒ–ï¼Œä¸è¦ä¸€æ¬¡æ€§æ”¹åŠ¨å¤ªå¤šï¼Œç¡®ä¿æ¯ä¸ªæ”¹åŠ¨éƒ½ç»è¿‡å……åˆ†æµ‹è¯•ã€‚











